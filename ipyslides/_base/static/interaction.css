/* PDF printing styles, experimental */
@media print {
    body *:not(.ipyslides-print-node):not(.ipyslides-print-node.SlidesWrapper *) {
        display: none !important;
    }

    * {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important; /* Firefox */
        ::-webkit-scrollbar { height: 0 !important; width: 0 !important; }
    }

    /* Page size is set dynamically via @page in styles.py */
    html, body, .ipyslides-print-node {
        margin: 0 !important;
        padding: 0 !important;
    }
    .jp-ThemedContainer {
        all: unset !important; /* show all slides in print mode set in devtools */
    }
    .ipyslides-print-node:not(.SlidesWrapper) {
        all: unset !important;
        display: block !important;
        margin: 0 !important;
        padding: 0 !important;
    }
    .ipyslides-print-node .jupyter-only {
        display: none !important;
    }
    .ipyslides-print-node.SlidesWrapper.SlidesWrapper {
        display: table !important; /* Manages auto height for multiple slides */
        --contnetScale : 1 !important; /* Defualt for printing at same value */
        --show-snumber: none; /* set with JS */
    }
    .ipyslides-print-node.ipyslides-print-node,
    .ipyslides-print-node.SlidesWrapper > * { 
        visibility: hidden !important; /* avoid unessary elements/backgrounds in print */
    }
    .ipyslides-print-node.SlidesWrapper > .LogoHtml.LogoHtml,
    .ipyslides-print-node.SlidesWrapper > .FooterBox .Footer { 
        visibility: visible !important; /* keep footer visible but main nav hidden*/
    }
    .ipyslides-print-node.SlidesWrapper > .SBoxWrapper { /* This is main culprit to mess up print */
        position: absolute !important; /* otherwise it leaves some space at top unknown way */
        left: 0 !important;
        top: 0 !important;
        width: 100vw !important; /* exact page width */
        max-width: 100vw !important;  /* can't work without it */
        overflow: auto !important;
        height: max-content !important;
        z-index: -1 !important; /* behind everything */
    }
    .ipyslides-print-node.SlidesWrapper .SlideBox {
        display: flex !important;
        flex-direction: column !important;
        flex: 0 0 auto !important;   /* size to content; don't grow/shrink */
        height: auto !important;     /* expand to fit all slides */
        width: 100% !important;
        overflow: hidden !important;
        min-height: max-content !important;
    }
    .ipyslides-print-node.SlidesWrapper .SlideBox .SlideArea {
        position:  relative !important; /* to hold background image and stuff properly and itself in order */
        visibility: visible !important;
        transform: translateZ(0) scale(1) !important; /* still need to contain stuff properly inside it and have crispy text*/
        page-break-inside: avoid !important; /* avoid for slides printing */
        page-break-after: always !important;
    }
    .ipyslides-print-node.SlidesWrapper .SlideBox .SlideArea.SlideArea {
        background: var(--bg1-color) !important; /* user can set bg color per slide */
    }
    .ipyslides-print-node.SlidesWrapper .SlideBox .SlideArea:last-of-type  {
        page-break-after: avoid !important;
        break-after: avoid !important;
    }
    .ipyslides-print-node.SlidesWrapper .SlideBox .SlideArea:first-of-type  {
        page-break-before: avoid !important;
        break-before: avoid !important;
    }
    .ipyslides-print-node.SlidesWrapper .SlideBox .SlideArea:not(.n0) {
        --bar-bg-color: transparent; /* set with JS */
    }
    .ipyslides-print-node.SlidesWrapper .SlideBox .SlideArea:not(.n0)::after {
        content: attr(data-snum) !important; /* set with JS */
        display: var(--show-snumber) !important;  
        position: absolute !important;
        bottom: 3px !important; /* 1px above the bar */
        right: 6px !important;
        color: var(--fg2-color) !important;
        font-size: 12px !important;
        z-index: 10 !important;
    }
    .ipyslides-print-node.SlidesWrapper .SlideBox .SlideArea:not(.n0)::before {
        content: '';
        position: absolute !important;
        display: block !important;
        bottom: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 2px !important;
        background: var(--bar-bg-color) !important;
        z-index: 9 !important;
    }
}


/* ==========================================================================
   CONTENT ANIMATIONS - Composable & Modern
   ========================================================================== */

/* --- CSS VARIABLES (on top container, so can be changed globally) --- */
.SlideArea {
    --time: 0.6s;
    --distance: 120px;
    --angle: 180deg;
    --scale: 0.5;
    --blur: 10px;
    --perspective: 800px;
    --skew: 20deg;
    --origin: 50% 50%; /* Universal origin for transform-origin and clip-path effects */
}

.SlideArea .anim-iris,
.SlideArea [class*="anim-wipe"],
.SlideArea [class*="anim-flip"],
.SlideArea [class*="anim-perspective"] {
    --time: 0.8s; /* longer for clip-path reveals and 3D perspective */
}
.SlideArea .anim-iris {
    --time: 1s; /* even longer for iris to counter 150% radius lag effect */
}

/* --- BASE STATE --- */
.SlideArea [class*="anim-"]:not(.anim-group),
.SlideArea .anim-group > * {
    opacity: 0 !important;
    pointer-events: none;
    will-change: transform, opacity, clip-path;
    
    /* Use --origin for transform-origin (affects rotate, scale, flip, skew) */
    transform-origin: var(--origin, 50% 50%);
    
    /* Composed transform - all components combine automatically */
    transform: 
        translateX(var(--translate-x, 0)) 
        translateY(var(--translate-y, 0))
        translateZ(var(--translate-z, 0))
        scale(var(--scale-uniform, 1))
        scaleX(var(--scale-x, 1))
        scaleY(var(--scale-y, 1))
        rotate(var(--rotate, 0deg))
        rotateX(var(--rotate-x, 0deg))
        rotateY(var(--rotate-y, 0deg))
        skewX(var(--skew-x, 0deg))
        perspective(var(--persp, none));
    
    /* Composed filters */
    filter: 
        blur(var(--blur-val, 0px)) 
        brightness(var(--brightness, 1));
    
    transition: 
        opacity var(--time) ease, 
        transform var(--time) cubic-bezier(0.2, 0.8, 0.2, 1),
        filter var(--time) ease,
        clip-path var(--time) ease-in; 
}

/* --- ANIMATED STATE --- */
.SlideArea [class*="anim-"]:not(.anim-group)._ips-content-animated,
.SlideArea .anim-group > ._ips-content-animated {
    opacity: 1 !important;
    transform: translateX(0) translateY(0) translateZ(0) scale(1) scaleX(1) scaleY(1) rotate(0deg) rotateX(0deg) rotateY(0deg) skewX(0deg) perspective(none) !important;
    filter: blur(0px) brightness(1) !important;
    pointer-events: auto !important;
    transition-delay: var(--delay, 0s) !important;
}
.SlideArea .anim-group > ._ips-content-animated {
    transition-delay: calc(var(--delay, 0s) + var(--stagger, 0s)) !important;
}

/* Iris needs special clip-path with 150% radius for corner origins */
.SlideArea .anim-iris:not(.anim-group)._ips-content-animated,
.SlideArea .anim-group.anim-iris > ._ips-content-animated {
    clip-path: circle(150% at var(--origin, 50% 50%)) !important;
}
/* Wipe animations need inset(0 0 0 0) - fully visible */
.SlideArea [class*="anim-wipe"]:not(.anim-group)._ips-content-animated,
.SlideArea .anim-group[class*="anim-wipe"] > ._ips-content-animated {
    clip-path: inset(0 0 0 0) !important;
} 

/* Other animations clear clip-path completely */
.SlideArea [class*="anim-"]:not(.anim-iris):not([class*="anim-wipe"]):not(.anim-group)._ips-content-animated,
.SlideArea .anim-group:not(.anim-iris):not([class*="anim-wipe"]) > ._ips-content-animated {
    clip-path: none !important;
}

/* --- RESET FOR BACKWARD NAV & PRINT (higher specificity and ShowSlide is important to keep things visible) --- */
.SlideBox.AnimPrev .ShowSlide [class*="anim-"],
.SlideBox.AnimPrev .ShowSlide .anim-group > * {
    --time: 0s !important; /* instant reset */
    --delay: 0s !important;
    opacity: 1 !important; /* keep visible when going backward */
    transform: none !important;
    transition: none !important;
    filter: none !important;
    clip-path: none !important;
    pointer-events: auto !important;
}

@media print { /* make print mode more robust */
    .SlideBox .SlideArea [class*="anim-"],
    .SlideBox .SlideArea .anim-group > * {
        opacity: 1 !important;
        visibility: visible !important;
        transform: none !important;
        transition: none !important;
        filter: none !important;
        clip-path: none !important;
        pointer-events: auto !important;
    }
}

/* ==========================================================================
   ANIMATION COMPONENTS - Set CSS variables (composable!)
   ========================================================================== */

/* --- SLIDE ANIMATIONS --- */
.anim-slide-up:not(.anim-group),
.anim-group.anim-slide-up > * { 
    --translate-y: var(--distance);
}

.anim-slide-down:not(.anim-group),
.anim-group.anim-slide-down > * { 
    --translate-y: calc(var(--distance) * -1);
}

.anim-slide-left:not(.anim-group),
.anim-group.anim-slide-left > * { 
    --translate-x: var(--distance);
}

.anim-slide-right:not(.anim-group),
.anim-group.anim-slide-right > * { 
    --translate-x: calc(var(--distance) * -1);
}

/* Diagonal slides - set both X and Y */
.anim-slide-tl:not(.anim-group),
.anim-group.anim-slide-tl > * { 
    --translate-x: calc(var(--distance) * -0.7);
    --translate-y: calc(var(--distance) * -0.7);
}

.anim-slide-tr:not(.anim-group),
.anim-group.anim-slide-tr > * { 
    --translate-x: calc(var(--distance) * 0.7);
    --translate-y: calc(var(--distance) * -0.7);
}

.anim-slide-bl:not(.anim-group),
.anim-group.anim-slide-bl > * { 
    --translate-x: calc(var(--distance) * -0.7);
    --translate-y: calc(var(--distance) * 0.7);
}

.anim-slide-br:not(.anim-group),
.anim-group.anim-slide-br > * { 
    --translate-x: calc(var(--distance) * 0.7);
    --translate-y: calc(var(--distance) * 0.7);
}

/* --- WIPE ANIMATIONS (clip-path reveal) --- */
.anim-wipe-right:not(.anim-group),
.anim-group.anim-wipe-right > * { 
    clip-path: inset(0 100% 0 0);
}

.anim-wipe-left:not(.anim-group),
.anim-group.anim-wipe-left > * { 
    clip-path: inset(0 0 0 100%);
}

.anim-wipe-down:not(.anim-group),
.anim-group.anim-wipe-down > * { 
    clip-path: inset(100% 0 0 0);
}

.anim-wipe-up:not(.anim-group),
.anim-group.anim-wipe-up > * { 
    clip-path: inset(0 0 100% 0);
}

/* --- IRIS ANIMATION (circular reveal with --origin) --- */
.anim-iris:not(.anim-group),
.anim-group.anim-iris > * { 
    clip-path: circle(0% at var(--origin, 50% 50%));
}

/* --- ZOOM ANIMATIONS --- */
.anim-zoom:not(.anim-group),
.anim-group.anim-zoom > * { 
    --scale-uniform: var(--scale);
}

.anim-zoom-x:not(.anim-group),
.anim-group.anim-zoom-x > * { 
    --scale-x: var(--scale);
}

.anim-zoom-y:not(.anim-group),
.anim-group.anim-zoom-y > * { 
    --scale-y: var(--scale);
}

/* --- ROTATION ANIMATIONS --- */
.anim-rotate:not(.anim-group),
.anim-group.anim-rotate > * { 
    --rotate: var(--angle);
}

.anim-spin:not(.anim-group),
.anim-group.anim-spin > * { 
    --rotate: calc(var(--angle) * 2);
    --scale-uniform: calc(var(--scale) - 0.2);
}

/* --- SKEW ANIMATIONS --- */
.anim-skew-left:not(.anim-group),
.anim-group.anim-skew-left > * { 
    --skew-x: var(--skew, 20deg);
    --translate-x: calc(var(--distance) * -1);
}

.anim-skew-right:not(.anim-group),
.anim-group.anim-skew-right > * { 
    --skew-x: calc(var(--skew, 20deg) * -1);
    --translate-x: var(--distance);
}

/* --- FILTER ANIMATIONS --- */
.anim-blur:not(.anim-group),
.anim-group.anim-blur > * { 
    --blur-val: var(--blur);
}

.anim-brighten:not(.anim-group),
.anim-group.anim-brighten > * { 
    --brightness: 0;
    --blur-val: calc(var(--blur) * 2);
}

/* --- 3D FLIP ANIMATIONS --- */
.anim-flip-x:not(.anim-group),
.anim-group.anim-flip-x > * { 
    --persp: var(--perspective);
    --rotate-x: 90deg;
    --origin: center bottom; /* Flip up from bottom edge */
}

.anim-flip-x-reverse:not(.anim-group),
.anim-group.anim-flip-x-reverse > * { 
    --persp: var(--perspective);
    --rotate-x: -90deg;
    --origin: center top; /* Flip down from top edge */
}

.anim-flip-y:not(.anim-group),
.anim-group.anim-flip-y > * { 
    --persp: var(--perspective);
    --rotate-y: 90deg;
    --origin: left center; /* Flip right from left edge */
}

.anim-flip-y-reverse:not(.anim-group),
.anim-group.anim-flip-y-reverse > * { 
    --persp: var(--perspective);
    --rotate-y: -90deg;
    --origin: right center; /* Flip left from right edge */
}

/* --- 3D PERSPECTIVE ANIMATIONS --- */
.anim-perspective-up:not(.anim-group),
.anim-group.anim-perspective-up > * { 
    --persp: calc(var(--perspective) * 1.5);
    --translate-z: calc(var(--distance) * -4);
    --rotate-x: 15deg;
}

.anim-perspective-down:not(.anim-group),
.anim-group.anim-perspective-down > * { 
    --persp: calc(var(--perspective) * 1.5);
    --translate-z: calc(var(--distance) * -4);
    --rotate-x: -15deg;
}

.anim-perspective-left:not(.anim-group),
.anim-group.anim-perspective-left > * { 
    --persp: calc(var(--perspective) * 1.5);
    --translate-z: calc(var(--distance) * -4);
    --rotate-y: -15deg;
}

.anim-perspective-right:not(.anim-group),
.anim-group.anim-perspective-right > * { 
    --persp: calc(var(--perspective) * 1.5);
    --translate-z: calc(var(--distance) * -4);
    --rotate-y: 15deg;
}

/* --- COMBINED/SPECIAL ANIMATIONS --- */
.anim-bounce:not(.anim-group),
.anim-group.anim-bounce > * { 
    --translate-y: var(--distance);
    --scale-uniform: calc(var(--scale) + 0.3);
}

.anim-swing:not(.anim-group),
.anim-group.anim-swing > * { 
    --rotate: 30deg;
    --scale-uniform: var(--scale);
    --origin: top center; /* Swing from top like a pendulum */
}

.anim-elastic:not(.anim-group),
.anim-group.anim-elastic > * { 
    --scale-uniform: calc(var(--scale) - 0.2);
    transition-timing-function: cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
}

/* --- STAGGER DELAYS --- */
.anim-group > * { 
    --stagger: 0.05s; /* Fallback if JS doesn't run */
}